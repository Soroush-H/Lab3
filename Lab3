1.

for $x in doc('mondial/mondial.xml')/mondial/country
for $y in doc('mondial/mondial.xml')/mondial/sea
where $y/name = "Baltic Sea" and $x/@car_code = tokenize($y/@country, " ")
return tokenize($x/@capital, '-')

2.

let $list :=
  for $x in /mondial/desert
  order by $x/latitude descending
  return $x

return ('name= ', $list[1]/name , ' area=', $list[1]/area)

3.

<mountains>
{

    let $doc := doc("mondial/mondial.xml")
    for $continent in $doc//continent
    return <continent name="{$continent/name/text()}">
             {(let $countries := $doc//country[encompassed/@continent = $continent/@id]
               for $mountain in $doc//mountain[located/@country = $countries/@car_code]
               order by $mountain/elevation/number() descending
               return <highest elevation="{$mountain/elevation/number()}">
                        {$mountain/name/text()}
                      </highest>)[1]}
           </continent>
}
</mountains>


5.

let $continents :=
  for $x in doc('mondial/mondial.xml')/mondial/continent
  where $x/area > 9000000
  return lower-case($x/name)

let $cities1 :=
  for $x in doc('mondial/mondial.xml')/mondial/country/province/city
  where $x/latitude >= -35 and $x/latitude <= 35
  and $x/../../encompassed[1]/@continent = $continents
  return <cont cont = "{data($x/../../encompassed[1]/@continent)}"/>

let $cities2 :=
  for $x in doc('mondial/mondial.xml')/mondial/country/city
  where $x/latitude >= -35 and $x/latitude <= 35
  and $x/../encompassed[1]/@continent = $continents
  return <cont cont = "{data($x/../encompassed[1]/@continent)}"/>

return
  for $values in $continents
  let $count1 := count($cities1[@cont = $values])
  let $count2 := count($cities2[@cont = $values])
  return concat($values," ",$count1 + $count2)


7.

for $x in doc('mondial/mondial.xml')/mondial/organization
for $y in doc('mondial/mondial.xml')/mondial/country
where contains($x/name, 'Nuclear') and not(exists($x/established)) and $y/name = tokenize($x/@headq, '-')[2] and $y/encompassed/@continent = 'europe' return $x/name


8. (FUNKAR INTE)


declare function local:popIn($years as xs:integer, $country as xs:string)
{
for $x in doc("mondial/mondial.xml")/mondial/country
where exists($x/population_growth) and $country = data($x/name)
let $pop := data($x/population[last()])
let $growth := (<int>{$x/population_growth}</int> + 100) div 100
let $estpop := xs:long($pop*(math:pow($growth,$years)))
return $estpop
};

for $x in doc("mondial/mondial.xml")/mondial/country
order by $x/name
return
<country>
  <name>{$x/name} </name>
  <PopIn10>{local:popIn(10, $x/name)}</PopIn10>
  <PopIn25>{local:popIn(25, $x/name)}</PopIn25>
  <PopIn50>{local:popIn(50, $x/name)}</PopIn50>
  <PopIn100>{local:popIn(100, $x/name)}</PopIn100>
</country>







8.1
declare function local:pow($x as xs:double , $n as xs:integer ) as xs:double
{
  if($n eq 0)
   then 1
   else
    (let $h := $n idiv 2,
         $halfResult := local:pow($x, $h)
      return
            if($n mod 2 eq 0)
              then $halfResult * $halfResult
              else $x * $halfResult * $halfResult
        )

};



for $x in /mondial/country

let $year := max($x/population/@year)
let $pop := $x/popultion[@year = $year]
let $growth := ($x/population_growth div 100) +1
let $estpop := $pop*(local:pow($growth,10))

return
<country>
  <name>{$x/name} </name>
<year>{$year}</year>
<year>{$pop}</year>
<year>{$growth}</year>
<year>{$estpop}</year>
</country>





10.

declare function local:reachableFrom($countries as element(country)*, $oldreachable as element(country)*){
    let $newreachable :=
        for $allCountries in $countries
        for $countryReach in $oldreachable
        where $countryReach/border/@country = $allCountries/@car_code
        return $allCountries

    let $new := $newreachable union $oldreachable
    return if (count($oldreachable) = count($new)) then $new
    else local:reachableFrom($countries, $new)
};

let $countryData :=
  let $countries := /mondial/country
  let $country := $countries[name='Sweden']
  return local:reachableFrom($countries, $country)

return $countryData/name
